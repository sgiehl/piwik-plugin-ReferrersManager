name: Translation Updates

on:
  push:
    branches:
      - transupdate

jobs:
  build:

    runs-on: ubuntu-latest

    services:
      mysql:
        image: mysql:5.7
        env:
          MYSQL_ALLOW_EMPTY_PASSWORD: true
          MYSQL_ROOT_PASSWORD: ""
          MYSQL_DATABASE: piwik_tests
        ports:
          - 3306/tcp

    steps:
    - uses: shivammathur/setup-php@v1
      with:
        php-version: '7.3'
    - uses: actions/checkout@v2
      with:
        ref: 'transupdate'
        path: 'ReferrersManager'
    - uses: actions/checkout@v2
      with:
        repository: 'matomo-org/matomo'
        path: 'matomo'
        ref: '4.x-dev'
        lfs: false
    - uses: sgiehl/matomo-plugin-translations-update@v0.0.1
      env:
        PluginName: "ReferrersManager"
        TransifexUsername: ${{ secrets.TransifexUsername }}
        TransifexPassword: ${{ secrets.TransifexPassword }}
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
